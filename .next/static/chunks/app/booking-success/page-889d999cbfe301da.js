(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[408],{1049:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(5155),r=s(2115),n=s(63),l=s(2619),o=s.n(l),i=s(3947),c=s(8455),d=s(5299),m=s(2529),u=s(3664),p=s(3998),h=s(9156),x=s(8720),f=s(5282);let y=()=>{var e,t;let s=(0,n.useSearchParams)(),[l,y]=(0,r.useState)(null),[g,j]=(0,r.useState)(!0),N=null==s?void 0:s.get("session_id"),b=null==s?void 0:s.get("rental_id");return(0,r.useEffect)(()=>{(async()=>{var e,t,s,a,r,n,l;if(!N)return j(!1);try{if(b){let{error:r}=await h.N.from("rentals").update({status:"Active"}).eq("id",b);if(r){console.error("Failed to update rental status:",r);let a="Failed to confirm rental. Please contact support.";"PGRST116"===r.code?a="Rental not found. Please contact support with your payment confirmation.":(null==(e=r.message)?void 0:e.includes("permission"))?a="Access denied. Please contact support to complete your rental confirmation.":((null==(t=r.message)?void 0:t.includes("network"))||(null==(s=r.message)?void 0:s.includes("timeout")))&&(a="Network error. Your payment was successful, but confirmation failed. Please refresh the page or contact support."),x.oR.error(a,{duration:8e3})}let n=localStorage.getItem("pendingPaymentDetails");if(n)try{let e=JSON.parse(n);if(console.log("\uD83D\uDCB3 Creating payment record after successful Stripe payment..."),e.rental_id===b){let t=new Date().toISOString().split("T")[0],{data:s,error:a}=await h.N.from("payments").insert({amount:e.amount,customer_id:e.customer_id,rental_id:e.rental_id,vehicle_id:e.vehicle_id,payment_date:t,payment_type:"Payment",method:"Card",status:"Applied",is_early:!1,remaining_amount:0,apply_from_date:e.apply_from_date}).select().single();if(a)console.error("❌ Failed to create payment record:",a),x.oR.error("Payment recorded by Stripe but failed to save locally. Please contact support.");else{console.log("✅ Payment record created successfully:",s.id);try{console.log("\uD83D\uDD04 Applying payment to charges...");let{data:e,error:t}=await h.N.functions.invoke("apply-payment",{body:{paymentId:s.id}});t?console.error("❌ Failed to apply payment:",t):console.log("✅ Payment applied successfully:",e)}catch(e){console.error("❌ Error applying payment:",e)}}localStorage.removeItem("pendingPaymentDetails")}else console.warn("⚠️ Payment details rental_id mismatch")}catch(e){console.error("Error parsing payment details:",e)}let{data:l,error:o}=await h.N.from("rentals").select("\n              *,\n              customer:customers(*),\n              vehicle:vehicles(*)\n            ").eq("id",b).single();if(o){console.error("Failed to fetch rental details:",o);let e="Unable to load rental details.";"PGRST116"===o.code?e="Rental details not found. Your payment was successful. Please contact support.":(null==(a=o.message)?void 0:a.includes("permission"))&&(e="Access error loading rental details. Please contact support."),x.oR.error(e,{duration:8e3,description:"Your payment was processed successfully. We'll send confirmation details to your email."})}else if(l){let e=l.vehicle.make&&l.vehicle.model?"".concat(l.vehicle.make," ").concat(l.vehicle.model):l.vehicle.reg;y({rental_id:l.id,booking_ref:l.id.substring(0,8).toUpperCase(),customer_name:l.customer.name,customer_email:l.customer.email,vehicle_name:e,vehicle_reg:l.vehicle.reg,pickup_date:(0,f.GP)(new Date(l.start_date),"MMM dd, yyyy"),return_date:(0,f.GP)(new Date(l.end_date),"MMM dd, yyyy"),rental_period_type:l.rental_period_type,monthly_amount:l.monthly_amount,status:l.status})}}else{let e=localStorage.getItem("pending_booking");if(e){let t=JSON.parse(e);y(t),localStorage.removeItem("pending_booking")}}}catch(t){console.error("Error processing booking confirmation:",t);let e="An error occurred while processing your confirmation.";t instanceof TypeError&&(null==(r=t.message)?void 0:r.includes("fetch"))?e="Network connection error. Please check your internet connection and refresh the page.":(null==(n=t.message)?void 0:n.includes("JSON"))?e="Data processing error. Please refresh the page or contact support.":(null==(l=t.message)?void 0:l.includes("session_id"))&&(e="Invalid payment session. If your payment was processed, please contact support with your payment confirmation."),x.oR.error(e,{duration:1e4,description:"If your payment was successful, your rental will be confirmed. Please contact support if you need assistance."})}finally{j(!1)}})()},[N,b]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.A,{}),(0,a.jsx)("main",{className:"min-h-screen bg-gradient-to-b from-background to-muted flex items-center justify-center py-16",children:(0,a.jsx)("div",{className:"container mx-auto px-6 max-w-2xl",children:(0,a.jsx)("div",{className:"bg-card rounded-2xl shadow-metal border border-accent/20 p-8 md:p-12",children:g?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(d.A,{className:"w-12 h-12 text-accent mx-auto mb-4 animate-spin"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Processing your booking confirmation..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(m.A,{className:"w-12 h-12 text-green-500"})}),(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-display font-bold text-gradient-metal mb-2 text-center",children:"Rental Confirmed"}),(null==l?void 0:l.booking_ref)&&(0,a.jsxs)("p",{className:"text-lg text-center mb-6",children:["Reference: ",(0,a.jsx)("span",{className:"font-semibold text-accent",children:l.booking_ref})]}),(0,a.jsx)("p",{className:"text-lg text-muted-foreground mb-8 text-center",children:"Thank you for your rental. Your payment has been processed successfully."}),l&&(0,a.jsxs)("div",{className:"bg-accent/5 border border-accent/20 rounded-lg p-6 mb-8 text-left space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Rental Summary"}),(0,a.jsxs)("div",{className:"grid gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Vehicle:"}),(0,a.jsx)("span",{className:"font-medium",children:l.vehicle_name})]}),l.vehicle_reg&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Registration:"}),(0,a.jsx)("span",{className:"font-medium",children:l.vehicle_reg})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Start Date:"}),(0,a.jsx)("span",{className:"font-medium",children:l.pickup_date||l.pickup_date})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"End Date:"}),(0,a.jsx)("span",{className:"font-medium",children:l.return_date})]}),l.rental_period_type&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Period Type:"}),(0,a.jsx)("span",{className:"font-medium",children:l.rental_period_type})]}),l.monthly_amount&&(0,a.jsxs)("div",{className:"flex justify-between pt-3 border-t border-accent/20",children:[(0,a.jsx)("span",{className:"text-muted-foreground font-medium",children:"Rental Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-accent text-lg",children:["$",null==(e=l.monthly_amount)?void 0:e.toLocaleString()]})]}),l.total&&(0,a.jsxs)("div",{className:"flex justify-between pt-3 border-t border-accent/20",children:[(0,a.jsx)("span",{className:"text-muted-foreground font-medium",children:"Amount Paid:"}),(0,a.jsxs)("span",{className:"font-bold text-accent text-lg",children:["$",null==(t=l.total)?void 0:t.toLocaleString()]})]})]})]}),(0,a.jsxs)("div",{className:"bg-accent/5 border border-accent/20 rounded-lg p-6 mb-8 text-left",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[(0,a.jsx)(u.A,{className:"w-5 h-5 text-accent"}),"What's Next?"]}),(0,a.jsxs)("ul",{className:"space-y-3 text-muted-foreground",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 text-accent mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:"A confirmation email will be sent to your email address with your rental details"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 text-accent mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:"Your rental is confirmed and ready for pickup at the scheduled time"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 text-accent mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:"You will receive pickup instructions 24 hours before your rental period"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 text-accent mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:"Your security deposit is held and will be released after the rental period"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,a.jsx)(o(),{href:"/",children:(0,a.jsx)(p.$,{className:"gradient-accent hover-lift w-full sm:w-auto",children:"Return to Home"})}),(0,a.jsx)(o(),{href:"/contact",children:(0,a.jsx)(p.$,{variant:"outline",className:"w-full sm:w-auto",children:"Contact Support"})})]})]})})})}),(0,a.jsx)(c.A,{})]})},g=()=>(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}),children:(0,a.jsx)(y,{})})},1873:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},2529:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3664:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},4764:(e,t,s)=>{Promise.resolve().then(s.bind(s,1049))},5299:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7494:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]])},9141:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},9427:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]])},9540:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]])}},e=>{e.O(0,[7615,8864,8720,5282,8522,8441,1255,7358],()=>e(e.s=4764)),_N_E=e.O()}]);